<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday Aarav</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-start: #0f172a; /* deep navy */
            --bg-end: #1e1b4b; /* deep purple */
        }

        body {
            margin: 0;
            background: linear-gradient(135deg, var(--bg-start), var(--bg-end));
            background-size: 200% 200%;
            color: #ffffff;
            font-family: 'Inter', sans-serif;
            overflow: hidden; /* Hidden initially until card closes */
            transition: background 2s ease-in-out;
        }

        .bg-shifted {
            --bg-start: #1e1b4b;
            --bg-end: #3b0764; /* lighter purple shift */
            animation: gradientShift 15s ease infinite;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .font-serif { font-family: 'Playfair Display', serif; }
        
        /* Glows */
        .text-glow {
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.4), 0 0 30px rgba(168, 85, 247, 0.6);
        }
        .box-glow {
            box-shadow: 0 0 30px rgba(168, 85, 247, 0.3);
        }

        /* 3D Gift Box */
        .scene {
            perspective: 1000px;
            width: 160px;
            height: 160px;
            margin: 0 auto;
            z-index: 50;
        }
        
        .cube {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transform: rotateX(-15deg) rotateY(45deg);
            transition: transform 1.5s cubic-bezier(0.25, 1, 0.5, 1);
            cursor: pointer;
        }

        .cube::after {
            content: '';
            position: absolute;
            bottom: -50px; left: 50%;
            width: 200px; height: 40px;
            background: rgba(0,0,0,0.6);
            transform: translateX(-50%) rotateX(90deg);
            filter: blur(15px);
            border-radius: 50%;
            pointer-events: none;
        }

        .cube:hover {
            transform: rotateX(-20deg) rotateY(55deg) scale(1.05);
        }

        .cube.open {
            transform: translateY(20px) rotateX(-5deg) rotateY(180deg) scale(1.1);
            cursor: default;
        }

        .face {
            position: absolute;
            width: 160px;
            height: 160px;
            background: linear-gradient(135deg, #3b0764, #1e1b4b);
            border: 1px solid rgba(168, 85, 247, 0.5);
            box-shadow: inset 0 0 30px rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        /* Gold Ribbon */
        .face::before, .face::after {
            content: ''; position: absolute; 
            background: linear-gradient(to right, #fbbf24, #f59e0b); 
            box-shadow: 0 0 10px rgba(251, 191, 36, 0.3);
        }
        .face::before { width: 24px; height: 100%; }
        .face::after { width: 100%; height: 24px; }
        
        .top { overflow: visible; } /* Allow bow to show */
        .top::before, .top::after { background: linear-gradient(to right, #fcd34d, #fbbf24); }

        /* The Bow */
        .bow {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 60px; height: 60px;
            z-index: 10;
        }
        .bow::before, .bow::after {
            content: '';
            position: absolute;
            width: 30px; height: 30px;
            border: 6px solid #fbbf24;
            border-radius: 50% 50% 0 50%;
            top: 15px;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.2), 0 0 5px rgba(0,0,0,0.2);
        }
        .bow::before { left: -10px; transform: rotate(45deg); }
        .bow::after { right: -10px; transform: rotate(135deg); border-radius: 50% 50% 50% 0; }
        .bow-center {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 16px; height: 16px;
            background: #f59e0b;
            border-radius: 50%;
            z-index: 11;
            box-shadow: 0 0 5px rgba(0,0,0,0.4);
        }

        .front  { transform: rotateY(  0deg) translateZ(80px); }
        .right  { transform: rotateY( 90deg) translateZ(80px); }
        .back   { transform: rotateY(180deg) translateZ(80px); }
        .left   { transform: rotateY(-90deg) translateZ(80px); }
        .top    { transform: rotateX( 90deg) translateZ(80px); transform-origin: top; transition: transform 1.2s cubic-bezier(0.25, 1, 0.5, 1); }
        .bottom { transform: rotateX(-90deg) translateZ(80px); }

        .cube.open .top {
            transform: rotateX(200deg) translateZ(80px);
        }

        /* Glassmorphism Card */
        .glass-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        .card-rise {
            animation: cardRise 1.5s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        @keyframes cardRise {
            0% { transform: translateY(40px) scale(0.8); opacity: 0; }
            100% { transform: translateY(0) scale(1); opacity: 1; }
        }

        /* Scroll Animations */
        .fade-in-section {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 1s ease-out, transform 1s ease-out;
            will-change: opacity, visibility;
        }
        .fade-in-section.is-visible {
            opacity: 1;
            transform: none;
        }

        /* Timeline */
        .timeline-dot {
            box-shadow: 0 0 10px #a855f7;
        }

        /* Cake & Candles */
        .cake-tier {
            background: linear-gradient(to right, #6b21a8, #86198f);
            box-shadow: inset 0 5px 15px rgba(255,255,255,0.1), 0 5px 15px rgba(0,0,0,0.3);
        }
        .candle {
            width: 8px;
            height: 35px;
            background: repeating-linear-gradient(45deg, #fff, #fff 4px, #e879f9 4px, #e879f9 8px);
            border-radius: 2px;
            position: relative;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .candle:hover { transform: scale(1.1); }
        
        .flame {
            width: 12px;
            height: 20px;
            background: #fcd34d;
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            position: absolute;
            top: -22px;
            left: -2px;
            box-shadow: 0 0 15px #fcd34d, 0 0 30px #fb923c;
            animation: flicker 0.5s infinite alternate;
            transition: opacity 0.3s ease;
        }

        @keyframes flicker {
            0% { transform: scale(1) rotate(-1deg); box-shadow: 0 0 15px #fcd34d; }
            100% { transform: scale(1.1) rotate(2deg); box-shadow: 0 0 25px #f59e0b; }
        }

        .flame.blown {
            opacity: 0;
            animation: none;
        }

        /* Balloons */
        .balloon {
            width: 40px;
            height: 50px;
            background: rgba(168, 85, 247, 0.7);
            border-radius: 50% 50% 50% 50% / 40% 40% 60% 60%;
            position: absolute;
            bottom: -60px;
            cursor: pointer;
            box-shadow: inset -5px -5px 10px rgba(0,0,0,0.2), 0 0 10px rgba(168, 85, 247, 0.4);
            animation: floatUp linear forwards;
            transition: transform 0.1s;
        }
        .balloon::before {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 0; height: 0;
            border-left: 4px solid transparent;
            border-right: 4px solid transparent;
            border-bottom: 8px solid rgba(168, 85, 247, 0.7);
        }
        .balloon:active { transform: scale(1.2); }
        .balloon.popped { opacity: 0; transform: scale(1.5); transition: all 0.2s; }

        @keyframes floatUp {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-120vh) rotate(20deg); opacity: 0; }
        }

    </style>
</head>
<body>

    <!-- Audio Player (Lofi Background) -->
    <!-- Using a reliable royalty-free lofi track from pixabay -->
    <audio id="bgMusic" loop preload="auto">
        <source src="https://cdn.pixabay.com/download/audio/2022/05/27/audio_1808fbf07a.mp3" type="audio/mpeg">
    </audio>

    <!-- Mute Toggle -->
    <button id="muteBtn" class="fixed top-6 right-6 z-50 p-3 rounded-full bg-white/10 backdrop-blur-md border border-white/20 hover:bg-white/20 transition-all text-white opacity-0 pointer-events-none duration-1000">
        <svg id="volIcon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
            <path d="M11.536 14.01A8.47 8.47 0 0 0 14.026 8a8.47 8.47 0 0 0-2.49-6.01l-.708.707A7.48 7.48 0 0 1 13.025 8c0 2.071-.84 3.946-2.197 5.303l.708.707z"/>
            <path d="M10.121 12.596A6.48 6.48 0 0 0 12.025 8a6.48 6.48 0 0 0-1.904-4.596l-.707.707A5.48 5.48 0 0 1 11.025 8a5.48 5.48 0 0 1-1.61 3.89l.706.706z"/>
            <path d="M8.707 11.182A4.5 4.5 0 0 0 10.025 8a4.5 4.5 0 0 0-1.318-3.182L8 5.525A3.5 3.5 0 0 1 9.025 8 3.5 3.5 0 0 1 8 10.475l.707.707zM6.717 3.55A.5.5 0 0 1 7 4v8a.5.5 0 0 1-.812.39L3.825 10.5H1.5A.5.5 0 0 1 1 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06z"/>
        </svg>
    </button>

    <!-- Particles Canvas -->
    <canvas id="particleCanvas" class="fixed inset-0 pointer-events-none z-0"></canvas>

    <!-- 1. Intro Scene -->
    <div id="introScene" class="fixed inset-0 z-40 flex flex-col items-center justify-center transition-opacity duration-1000">
        <div class="scene" id="giftBoxContainer">
            <div class="cube" id="giftBox">
                <div class="face front"></div>
                <div class="face back"></div>
                <div class="face right"></div>
                <div class="face left"></div>
                <div class="face top">
                    <div class="bow">
                        <div class="bow-center"></div>
                    </div>
                </div>
                <div class="face bottom"></div>
            </div>
        </div>
        <p id="clickText" class="mt-16 text-sm md:text-base text-purple-200 tracking-widest uppercase text-glow animate-pulse">Click to Open</p>
    </div>

    <!-- 2. Card Reveal -->
    <div id="cardReveal" class="fixed inset-0 z-50 flex items-center justify-center hidden opacity-0 transition-opacity duration-700">
        <!-- Backdrop to close when clicking outside -->
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm transition-opacity" id="cardBackdrop"></div>
        <div class="glass-card w-11/12 max-w-md p-8 md:p-10 rounded-2xl text-center relative z-10 card-rise border border-white/20">
            <!-- Close Icon -->
            <button id="closeCardIcon" class="absolute top-4 right-4 p-2 text-white/50 hover:text-white hover:bg-white/10 rounded-full transition-all" aria-label="Close">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <h2 class="font-serif text-3xl md:text-4xl font-bold mb-6 text-glow mt-2">Happy Birthday,<br><span class="text-purple-300">Aarav</span> ðŸŽ‰</h2>
            <div class="w-16 h-[1px] bg-white/30 mx-auto mb-6"></div>
            <p class="text-lg md:text-xl font-light leading-relaxed text-gray-200 mb-8">
                "Since 2017. From Class 1 to 9. Thatâ€™s not just time. Thatâ€™s <span class="text-purple-300 font-semibold italic">history</span>."
            </p>
            <button id="closeCardBtn" class="px-8 py-3 bg-white text-purple-900 rounded-full font-semibold tracking-wide hover:bg-gray-200 transition-all hover:scale-105 active:scale-95 box-glow">
                Continue Journey
            </button>
        </div>
    </div>

    <!-- 3. Main Content (Hidden initially) -->
    <div id="mainContent" class="relative z-10 hidden flex-col w-full min-h-screen">
        
        <!-- Hero Title -->
        <section class="min-h-screen flex flex-col items-center justify-center px-4 relative">
            <h1 class="font-serif text-5xl md:text-7xl lg:text-8xl font-bold text-center text-glow mb-4 fade-in-section">
                Happy Birthday <br> <span class="text-purple-400">Aarav</span>
            </h1>
            <p class="text-gray-300 text-sm md:text-base tracking-[0.3em] uppercase fade-in-section delay-300 mt-6">Scroll to journey</p>
            <div class="absolute bottom-10 animate-bounce fade-in-section delay-500">
                <svg class="w-6 h-6 text-white/50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path></svg>
            </div>
        </section>

        <!-- 4. Scroll Section - Timeline -->
        <section class="py-20 px-6 relative max-w-4xl mx-auto w-full">
            <div class="text-center mb-16 fade-in-section">
                <h2 class="font-serif text-3xl md:text-4xl text-purple-300 text-glow">Since 2017...</h2>
            </div>

            <div class="relative wrap overflow-hidden p-4 h-full">
                <!-- Center Line -->
                <div class="absolute border-opacity-20 border-white h-full border-l-2 left-1/2 transform -translate-x-1/2"></div>
                
                <!-- Item 1 -->
                <div class="mb-12 flex justify-between items-center w-full right-timeline fade-in-section">
                    <div class="order-1 w-5/12 hidden md:block"></div>
                    <div class="z-20 flex items-center order-1 bg-purple-600 shadow-xl w-4 h-4 rounded-full timeline-dot absolute left-1/2 transform -translate-x-1/2"></div>
                    <div class="order-1 glass-card rounded-lg w-full md:w-5/12 px-6 py-4 ml-6 md:ml-0">
                        <h3 class="font-bold text-purple-300 text-xl mb-1">2017</h3>
                        <p class="text-sm leading-snug tracking-wide text-gray-300">Met. The beginning of the era.</p>
                    </div>
                </div>

                <!-- Item 2 -->
                <div class="mb-12 flex justify-between flex-row-reverse items-center w-full left-timeline fade-in-section">
                    <div class="order-1 w-5/12 hidden md:block"></div>
                    <div class="z-20 flex items-center order-1 bg-purple-600 shadow-xl w-4 h-4 rounded-full timeline-dot absolute left-1/2 transform -translate-x-1/2"></div>
                    <div class="order-1 glass-card rounded-lg w-full md:w-5/12 px-6 py-4 mr-6 md:mr-0 text-left md:text-right">
                        <h3 class="font-bold text-purple-300 text-xl mb-1">The Early Days</h3>
                        <p class="text-sm leading-snug tracking-wide text-gray-300">School chaos and unbreakable bonds from Class 1.</p>
                    </div>
                </div>

                <!-- Item 3 -->
                <div class="mb-12 flex justify-between items-center w-full right-timeline fade-in-section">
                    <div class="order-1 w-5/12 hidden md:block"></div>
                    <div class="z-20 flex items-center order-1 bg-purple-600 shadow-xl w-4 h-4 rounded-full timeline-dot absolute left-1/2 transform -translate-x-1/2"></div>
                    <div class="order-1 glass-card rounded-lg w-full md:w-5/12 px-6 py-4 ml-6 md:ml-0">
                        <h3 class="font-bold text-purple-300 text-xl mb-1">The Grind</h3>
                        <p class="text-sm leading-snug tracking-wide text-gray-300">Exams survived. Some barely, but we made it together.</p>
                    </div>
                </div>

                <!-- Item 4 -->
                <div class="mb-12 flex justify-between flex-row-reverse items-center w-full left-timeline fade-in-section">
                    <div class="order-1 w-5/12 hidden md:block"></div>
                    <div class="z-20 flex items-center order-1 bg-purple-600 shadow-xl w-4 h-4 rounded-full timeline-dot absolute left-1/2 transform -translate-x-1/2"></div>
                    <div class="order-1 glass-card rounded-lg w-full md:w-5/12 px-6 py-4 mr-6 md:mr-0 text-left md:text-right">
                        <h3 class="font-bold text-purple-300 text-xl mb-1">Present</h3>
                        <p class="text-sm leading-snug tracking-wide text-gray-300">Growing up together. Class 9 and beyond.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 5. Interactive Celebration Section -->
        <section class="py-24 px-4 flex flex-col items-center justify-center min-h-[70vh] relative fade-in-section" id="celebrationSection">
            <h2 class="text-2xl md:text-3xl font-light mb-12 text-center text-gray-200">Make a wish & click the candles</h2>
            
            <!-- CSS Cake -->
            <div class="relative flex flex-col items-center justify-end z-20">
                <!-- Candles Container -->
                <div class="flex space-x-6 mb-[-15px] z-30 relative" id="candlesContainer">
                    <div class="candle" onclick="blowCandle(this)"><div class="flame"></div></div>
                    <div class="candle" onclick="blowCandle(this)"><div class="flame"></div></div>
                    <div class="candle" onclick="blowCandle(this)"><div class="flame"></div></div>
                </div>
                <!-- Tiers -->
                <div class="cake-tier w-32 h-10 rounded-t-md z-20"></div>
                <div class="cake-tier w-48 h-12 rounded-t-lg z-10 mb-[-5px]"></div>
                <div class="cake-tier w-64 h-16 rounded-t-xl mb-[-5px]"></div>
            </div>

            <!-- Balloons Container -->
            <div id="balloonContainer" class="absolute inset-0 overflow-hidden pointer-events-none z-10"></div>
        </section>

        <!-- 6. Final Message Section -->
        <section class="min-h-[80vh] flex items-center justify-center px-6 text-center fade-in-section pb-20">
            <div>
                <h2 class="font-serif text-3xl md:text-5xl lg:text-6xl font-bold leading-tight text-glow text-white/90">
                    More birthdays.<br>
                    <span class="text-purple-400">More chaos.</span><br>
                    Same friendship.
                </h2>
                <div class="mt-12 w-24 h-[1px] bg-purple-500/50 mx-auto"></div>
            </div>
        </section>

    </div>

    <!-- JavaScript Logic -->
    <script>
        // --- 1. Audio Setup ---
        const bgMusic = document.getElementById('bgMusic');
        const muteBtn = document.getElementById('muteBtn');
        const volIcon = document.getElementById('volIcon');
        let audioStarted = false;
        
        bgMusic.volume = 0.15; // Set volume to 15% as requested

        muteBtn.addEventListener('click', () => {
            if (bgMusic.muted) {
                bgMusic.muted = false;
                volIcon.innerHTML = `<path d="M11.536 14.01A8.47 8.47 0 0 0 14.026 8a8.47 8.47 0 0 0-2.49-6.01l-.708.707A7.48 7.48 0 0 1 13.025 8c0 2.071-.84 3.946-2.197 5.303l.708.707z"/><path d="M10.121 12.596A6.48 6.48 0 0 0 12.025 8a6.48 6.48 0 0 0-1.904-4.596l-.707.707A5.48 5.48 0 0 1 11.025 8a5.48 5.48 0 0 1-1.61 3.89l.706.706z"/><path d="M8.707 11.182A4.5 4.5 0 0 0 10.025 8a4.5 4.5 0 0 0-1.318-3.182L8 5.525A3.5 3.5 0 0 1 9.025 8 3.5 3.5 0 0 1 8 10.475l.707.707zM6.717 3.55A.5.5 0 0 1 7 4v8a.5.5 0 0 1-.812.39L3.825 10.5H1.5A.5.5 0 0 1 1 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06z"/>`;
            } else {
                bgMusic.muted = true;
                volIcon.innerHTML = `<path d="M6.717 3.55A.5.5 0 0 1 7 4v8a.5.5 0 0 1-.812.39L3.825 10.5H1.5A.5.5 0 0 1 1 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06zm7.137 2.096a.5.5 0 0 1 0 .708L12.207 8l1.647 1.646a.5.5 0 0 1-.708.708L11.5 8.707l-1.646 1.647a.5.5 0 0 1-.708-.708L10.793 8 9.146 6.354a.5.5 0 1 1 .708-.708L11.5 7.293l1.646-1.647a.5.5 0 0 1 .708 0z"/>`;
            }
        });

        // --- 2. Canvas Particles & Confetti Engine ---
        const canvas = document.getElementById('particleCanvas');
        const ctx = canvas.getContext('2d');
        let width, height;
        let particles = [];
        let confetti = [];

        function resizeCanvas() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        class Particle {
            constructor() {
                this.x = Math.random() * width;
                this.y = Math.random() * height;
                this.size = Math.random() * 2;
                this.speedY = Math.random() * 0.5 + 0.1;
                this.alpha = Math.random() * 0.5 + 0.1;
            }
            update() {
                this.y -= this.speedY;
                if (this.y < 0) {
                    this.y = height;
                    this.x = Math.random() * width;
                }
            }
            draw() {
                ctx.fillStyle = `rgba(255, 255, 255, ${this.alpha})`;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        class Confetto {
            constructor(x, y) {
                this.x = x || width / 2;
                this.y = y || height / 2 + 100;
                this.size = Math.random() * 8 + 4;
                this.speedX = (Math.random() - 0.5) * 10;
                this.speedY = Math.random() * -10 - 5;
                this.color = `hsl(${Math.random() * 360}, 80%, 60%)`;
                this.rotation = Math.random() * 360;
                this.rotSpeed = (Math.random() - 0.5) * 10;
                this.gravity = 0.2;
            }
            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                this.speedY += this.gravity;
                this.rotation += this.rotSpeed;
            }
            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation * Math.PI / 180);
                ctx.fillStyle = this.color;
                ctx.fillRect(-this.size/2, -this.size/2, this.size, this.size);
                ctx.restore();
            }
        }

        for (let i = 0; i < 50; i++) particles.push(new Particle());

        function triggerConfetti(x, y, count = 100) {
            for (let i = 0; i < count; i++) {
                confetti.push(new Confetto(x, y));
            }
        }

        function animate() {
            ctx.clearRect(0, 0, width, height);
            
            particles.forEach(p => { p.update(); p.draw(); });
            
            for (let i = confetti.length - 1; i >= 0; i--) {
                let c = confetti[i];
                c.update();
                c.draw();
                if (c.y > height) confetti.splice(i, 1);
            }
            
            requestAnimationFrame(animate);
        }
        animate();

        // --- 3. Interactions & Transitions ---
        const giftBox = document.getElementById('giftBox');
        const clickText = document.getElementById('clickText');
        const introScene = document.getElementById('introScene');
        const cardReveal = document.getElementById('cardReveal');
        const closeCardBtn = document.getElementById('closeCardBtn');
        const closeCardIcon = document.getElementById('closeCardIcon');
        const cardBackdrop = document.getElementById('cardBackdrop');
        const mainContent = document.getElementById('mainContent');

        function closeCard() {
            cardReveal.classList.add('opacity-0');
            introScene.style.opacity = '0';
            
            setTimeout(() => {
                cardReveal.classList.add('hidden');
                introScene.classList.add('hidden');
                
                // Background shift & show main
                document.body.classList.add('bg-shifted');
                document.body.style.overflow = 'auto'; // Enable scrolling
                
                mainContent.classList.remove('hidden');
                mainContent.classList.add('flex');
                
                // Re-trigger observer for newly visible elements
                observeElements();
                
                // Start occasional balloons
                spawnBalloonsPeriodically();
            }, 700);
        }

        closeCardBtn.addEventListener('click', closeCard);
        closeCardIcon.addEventListener('click', closeCard);
        cardBackdrop.addEventListener('click', closeCard);

        giftBox.addEventListener('click', () => {
            if (giftBox.classList.contains('open')) return;
            
            // Start Audio
            if (!audioStarted) {
                bgMusic.play().catch(e => console.log("Audio autoplay blocked", e));
                muteBtn.classList.remove('opacity-0', 'pointer-events-none');
                audioStarted = true;
            }

            giftBox.classList.add('open');
            clickText.style.opacity = '0';
            
            // Show Card Reveal smoothly after box opens
            setTimeout(() => {
                cardReveal.classList.remove('hidden');
                // trigger small reflow
                void cardReveal.offsetWidth;
                cardReveal.classList.remove('opacity-0');
                triggerConfetti(width/2, height/2 + 50, 50); // subtle confetti
            }, 1000);
        });

        // --- 4. Scroll Fade Animations ---
        function observeElements() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('is-visible');
                        // observer.unobserve(entry.target); // keep it dynamic or unobserve
                    }
                });
            }, { threshold: 0.1, rootMargin: "0px 0px -50px 0px" });

            document.querySelectorAll('.fade-in-section').forEach(el => observer.observe(el));
        }

        // --- 5. Interactive Celebration (Cake & Balloons) ---
        let candlesBlown = 0;
        function blowCandle(candleDiv) {
            const flame = candleDiv.querySelector('.flame');
            if (!flame.classList.contains('blown')) {
                flame.classList.add('blown');
                candlesBlown++;
                
                // Get position for confetti
                const rect = candleDiv.getBoundingClientRect();
                triggerConfetti(rect.left + rect.width/2, rect.top, 30);
                
                if (candlesBlown === 3) {
                    setTimeout(() => {
                        triggerConfetti(width/2, height/2, 150);
                    }, 300);
                }
            }
        }

        function spawnBalloonsPeriodically() {
            setInterval(() => {
                if(Math.random() > 0.6) return; // random chance
                createBalloon();
            }, 2000);
        }

        function createBalloon() {
            const container = document.getElementById('balloonContainer');
            if (!container) return;
            
            const balloon = document.createElement('div');
            balloon.classList.add('balloon', 'pointer-events-auto');
            
            // Random styling
            const colors = ['#a855f7', '#d8b4fe', '#c084fc', '#e879f9'];
            balloon.style.background = colors[Math.floor(Math.random() * colors.length)];
            balloon.style.left = Math.random() * 90 + 5 + '%';
            
            // Random duration
            const duration = Math.random() * 5 + 8; // 8-13s
            balloon.style.animationDuration = duration + 's';
            
            // Pop interaction
            balloon.addEventListener('click', (e) => {
                balloon.classList.add('popped');
                triggerConfetti(e.clientX, e.clientY, 20);
                setTimeout(() => balloon.remove(), 200);
            });

            container.appendChild(balloon);
            
            // Cleanup
            setTimeout(() => {
                if(balloon.parentNode) balloon.remove();
            }, duration * 1000);
        }

    </script>
</body>
</html>